# Theory

- overuse of "this" to start sentences

## Resting/reference/background potential energy
A measurement of spurious mixing with a physical basis comes from the reference potential energy (RPE; Winters et al., 1995). This is the lowest attainable potential energy of a given fluid, where there is no energy available for motion. To calculate this state, the fluid must be adiabatically re-sorted to a stable stratification, where every fluid parcel is spread laterally across the entire domain. The sum of the reference potential energy and the available potential energy (APE) gives the total potential energy in the system. Mathematically, the RPE is expressed as

$$\mathrm{RPE} = g \int_\Omega z \rho^*(z)\,\mathrm dV,$$

where $g$ is the gravitational constant; $z$ is the height, positive upward; $\Omega$ is the domain; $V$ is the volume; and $\rho^*$ is the adiabatically re-sorted density profile, known as the reference density. The reference density is well-defined when a linear equation of state is used. However, when a nonlinear equation of state is used, a fluid parcel's density depends on its depth (more precisely, its hydrostatic pressure), which changes when the domain is re-sorted. A naive resorting of fluid parcels under a nonlinear equation of state may not be stably stratified due to this compressibility effect.

While it's possible to exactly calculate the reference density profile for a non-linear equation of state, it's very expensive (appendix of Ilicak et al., 2012). Using an approximation, such as calculating the density using a reference pressure significantly decreases the cost of the calculation, at the expense of incurring an error in the RPE. An alternative is to construct a volume frequency distribution of fluid parcels as a function of temperature and salinity (Saenz et al., 2015). This has a lower computational cost than adiabatic sorting, but again doesn't capture compressibility effects, which are argued to be minor. For simplicity of calculation we will use a linear equation of state. This eliminates the consequences of a nonlinear equation of state such as cabbeling and thermobaricity, as well as the effect of compressibility on the reference profile. Computation of the RPE is inexpensive and exact for a given fluid state, as no approximations are made during construction of the reference density profile.

- probably just needs EOS to be incompressible, rather than fully linear

In a numerical model of the hydrostatic primitive equations that exhibits identically zero mixing, with no buoyancy forcing, every fluid parcel must necessarily maintain its temperature and salinity. Under a linear equation of state, the density of any fluid parcel is thus constant. In this case, the adiabatic resorting of the entire fluid yields an unchanging reference density profile and therefore constant RPE, regardless of the actual depth or location of the parcels. Thus, when all parameterised mixing is disabled, and there is no buoyancy forcing, a model with zero spurious mixing will have constant RPE.

It is very unlikely that a model would experience exactly zero spurious mixing under nontrivial conditions.

- unless it's isopycnal

By designing experiments with all explicit mixing disabled and without buoyancy forcing, any increase in RPE over time can be attributed to spurious mixing as a result of the model's numerics. As an example, consider a limited advection scheme, i.e. one which is unable to create denser or lighter densities than already exist. Spurious mixing will create (or add to) some intermediate density class between two pre-existing densities. Considering the new reference density profile, it is clear that the centre of mass of the adiabatically re-sorted fluid is higher than prior to mixing. This manifests as in increase in the RPE. Conversely, RPE can only be decreased by lowering the centre of mass of the adiabatically re-sorted fluid.

## The orientation of spurious mixing

In many models, there is an explicit distinction between the horizontal and vertical dynamics. This is particularly the case in models with a generalised vertical coordinate, such as those employing the ALE algorithm. MOM6 performs its regridding/remapping implementation of ALE in a distinct part of a timestep, after the horizontal dynamics have been resolved. Taking advantage of this distinction, we can diagnose the instantaneous RPE at multiple points during a single timestep; at the beginning of a timestep, after horizontal dynamics, and after regridding/remapping has been performed. We denote these three calculations of instantaneous RPE as $\text{RPE}_i$, $\text{RPE}_h$ and $\text{RPE}_v$, respectively. The change in RPE due to horizontal dynamics is simply $\text{RPE}_h - \text{RPE}_i$, and similarly the change due to regridding/remapping is $\text{RPE}_v - \text{RPE}_h$.

The RPE contributions must be carefully calculated so that they include only information from relevant portions of a single timestep. This means that the increases in RPE may be small, from slight changes in density or fluid parcel volume. Diagnosing an instantaneous rate of change of RPE within a timestep may then involve dividing a small change in RPE by the length of the timestep, which may be short. The division of two small quantities is an operation that may be imprecise in floating-point arithmetic, therefore in order to derive a significant result from these RPE changes, we ensure that a sufficient number of samples are taken.

- imprecision is in the subtraction of two similar RPE values, maybe the point is just that the RPE change is a function of small changes in model state

Previous analyses of spurious mixing through changes in RPE have only used a timeseries of RPE taken from a single stage of in a timestep. This means that spurious mixing is only diagnosed for the model as a whole, and can't be attributed to any finer grain parts of the dynamics. Our extension of separating RPE contributions allows us to address the interplay of different components, such as the order of advection scheme chosen, the order of accuracy of vertical reconstruction used for remapping, and the specific impact of choice of vertical coordinate. Determining the dominant orientation of spurious mixing is also important because of the anisotropy of horizontal and vertical coordinates in ocean models. Some component of the horizontal spurious mixing may be diapycnal in the presence of sloping isopycnals, and therefore manifests in an RPE change with a linear equation of state. Conversely, spurious mixing across vertical surfaces, due to regridding/remapping, will directly effect the vertical profile of density. These are important considerations for evaluation of vertical coordinates.
